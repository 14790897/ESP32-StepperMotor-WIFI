# ESP32 ULN2003 步进电机WiFi控制器

本项目使用ESP32和ULN2003驱动芯片控制28BYJ-48步进电机，支持WiFi远程控制和Web界面操作。

## 硬件连接

### 所需组件
- ESP32开发板 (本项目使用 airm2m_core_esp32c3)
- ULN2003驱动板
- 28BYJ-48步进电机
- 5V电源适配器
- 杜邦线

### 接线图

```
ESP32 GPIO    →    ULN2003驱动板
GPIO1         →    IN1
GPIO12        →    IN2
GPIO18        →    IN3
GPIO19        →    IN4
GND           →    GND
5V            →    VCC (或使用外部5V电源)

ULN2003驱动板  →   28BYJ-48步进电机
OUT1          →    蓝线
OUT2          →    粉线
OUT3          →    黄线
OUT4          →    橙线
VCC           →    红线
```

### 重要注意事项
1. **电源要求**: 28BYJ-48步进电机需要5V电源，ESP32的3.3V输出功率不足
2. **ULN2003**: 这是一个达林顿晶体管阵列，可以将ESP32的3.3V信号放大到5V
3. **共地**: 确保ESP32和ULN2003驱动板共地连接

## 软件功能

### WiFi Web控制界面
- 🌐 **现代化Web界面** - 响应式设计，支持手机和电脑访问
- 🎮 **直观控制按钮** - 一键控制电机正转、反转、停止
- 📊 **实时状态显示** - 显示电机运行状态和最后执行的命令
- 🔄 **多种控制模式** - 支持完整旋转、半圈旋转、90度精确控制

### 控制命令
支持以下控制命令（Web界面和串口都可用）：
- `f` - 正转一圈 (2048步)
- `b` - 反转一圈 (2048步)
- `h` - 正转半圈 (1024步)
- `r` - 反转半圈 (1024步)
- `q` - 正转90度 (512步)
- `e` - 反转90度 (512步)
- `s` - 停止电机

### 技术参数
- **步进模式**: 8步半步模式 (更平滑的运动)
- **步进角度**: 0.176° (2048步/360°)
- **步进延时**: 2毫秒 (可调整速度)
- **串口波特率**: 115200

## WiFi配置

### 配置步骤
1. 打开 `src/main.cpp` 文件
2. 找到WiFi配置部分：
   ```cpp
   const char* ssid = "YOUR_WIFI_SSID";        // 请修改为您的WiFi名称
   const char* password = "YOUR_WIFI_PASSWORD"; // 请修改为您的WiFi密码
   ```
3. 将 `YOUR_WIFI_SSID` 替换为您的WiFi网络名称
4. 将 `YOUR_WIFI_PASSWORD` 替换为您的WiFi密码

### 注意事项
- 支持2.4GHz WiFi网络（不支持5GHz）
- WiFi名称和密码区分大小写
- 确保ESP32在WiFi信号覆盖范围内

## 编译和上传

1. 确保已安装PlatformIO
2. 配置WiFi信息（见上方WiFi配置部分）
3. 在项目目录下运行：
   ```bash
   pio run --target upload
   ```
4. 打开串口监视器：
   ```bash
   pio device monitor
   ```
5. 查看串口输出获取ESP32的IP地址
6. 在浏览器中访问该IP地址

## Web界面使用

### 访问界面
1. ESP32连接WiFi成功后，串口会显示IP地址
2. 在浏览器中输入该IP地址，例如：`http://192.168.1.100`
3. 界面会自动加载，显示步进电机控制面板

### 界面功能
- **系统状态区域**：显示电机运行状态、最后执行命令和IP地址
- **完整旋转控制**：正转一圈、反转一圈按钮
- **半圈旋转控制**：正转半圈、反转半圈按钮
- **精确控制**：正转90度、反转90度按钮
- **停止控制**：立即停止电机按钮

### 特性
- 📱 **响应式设计**：支持手机、平板、电脑访问
- 🔄 **实时状态更新**：每2秒自动更新电机状态
- 🎨 **现代化UI**：美观的渐变色彩和动画效果
- ⚡ **快速响应**：点击按钮立即执行命令

## 代码说明

### 步进序列
使用8步半步模式，提供更平滑的运动：
```cpp
int stepSequence[8][4] = {
  {1, 0, 0, 0},  // 步骤1
  {1, 1, 0, 0},  // 步骤2
  {0, 1, 0, 0},  // 步骤3
  {0, 1, 1, 0},  // 步骤4
  {0, 0, 1, 0},  // 步骤5
  {0, 0, 1, 1},  // 步骤6
  {0, 0, 0, 1},  // 步骤7
  {1, 0, 0, 1}   // 步骤8
};
```

### 主要函数
- `stepMotor(int steps, bool clockwise)`: 控制步进电机运动
- `setStep(int step)`: 设置当前步进状态
- `stopMotor()`: 停止电机并关闭所有线圈

## 故障排除

### 电机不转动
1. 检查接线是否正确
2. 确认5V电源是否充足
3. 检查ULN2003驱动板LED指示灯

### 电机转动不平滑
1. 调整 `stepDelay` 参数
2. 检查电源稳定性
3. 确认接线牢固

### 电机发热严重
1. 在不使用时调用 `stopMotor()` 关闭线圈
2. 检查电源电压是否过高
3. 考虑添加散热措施

## 扩展功能

### 已实现功能
- ✅ WiFi远程控制
- ✅ Web界面操作
- ✅ 实时状态监控
- ✅ 多种控制模式
- ✅ 响应式设计

### 可扩展功能
- 🔧 速度控制滑块
- 📍 位置反馈显示
- 🔄 多电机同步控制
- ⚙️ PWM调速功能
- 📈 加减速控制
- 🔐 访问权限控制
- 📊 运行数据记录
- 🌡️ 温度监控
- 🔔 状态推送通知

## 项目特色

- 🚀 **现代化架构**：使用异步Web服务器，性能优异
- 🎨 **精美界面**：现代化UI设计，用户体验佳
- 📱 **跨平台支持**：支持手机、平板、电脑访问
- ⚡ **实时响应**：WebSocket实时通信，状态同步
- 🔧 **易于扩展**：模块化代码结构，便于二次开发
